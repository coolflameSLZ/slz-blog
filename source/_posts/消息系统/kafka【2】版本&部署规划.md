---
title: kafka【2】版本&部署规划
toc: true
categories:
  - 消息系统
  - kafka
tags:
  - kafka
hide: false
sortn: 20
date: 2021-08-02 12:26:02
---



<!-- more -->

------



## 版本选择

Kafka 目前总共演进了 7 个大版本，分别是 0.7、0.8、0.9、0.10、0.11、1.0 和 2.0



### 最低版本使用要求：

- （总体上不建议使用）

- 至少要选择 0.8.2.2 ，
- 使用 老版本 Producer API ， 
- 老版本 Consumer API。

### 0.9版本注意事项：

- （总体上不建议使用）

- 必须使用 新版本Producer API ，老版本Consumer API
- 不要使用0.9版本中的 新版本Consumer API ，bug超多

### 0.10版本注意事项：

- 如果使用的话，就用最优小版本 **0.10.2.2**

- 0.10.2.2 版本起，使用 新版本 Producer API ，新版本 Consumer API 
- 0.10.2.2 修复了一个可能导致 Producer 性能降低的 Bug， 基于性能的缘故你也应该升级到 0.10.2.2

### 0.11版本注意事项：

- 如果使用的话，就用最优小版本 **0.11.0.3**

- 0.11.0.3版本，引入了两个重量级的功能
  - 幂等性 Producer API 以及 事务 Transaction API
  - 对 Kafka 消息格式做了重构。

### 1.0、2.0版本

- 主要增加的功能是流处理计算功能，
- 消息引擎方面，没什么变更。
- 如果不使用流处理功能，则不用升级。

### 版本选择总结：

- 无需流处理功能，则选择尽量将版本选为 0.11.0.3，这个版本的消息引擎功能已经非常完善了

- 不论你用的是哪个版本，都请尽量保持服务器端版本和客户端版本一致， 否则可能损失很多 Kafka 为你提供的性能优化收益

  

## 部署方式



### 操作系统选择linux

- 实际上 Kafka 客户端底层使用了 Java 的 selector，selector 在 Linux 上的实现机制是 epoll，而在 Windows 平台上的实现机制是select。因此在这一点上将 Kafka 部署在 Linux 上是有优势的，因为能够获得更高效的 I/O 性能
- 在 Linux 部署 Kafka 能够享受到零拷贝技术所带来的 快速数据传输特性



### 硬盘是否需要RAID

- kafka自带高可用策略，无需RAID，使用普通磁盘组成存储空间即可。 使用机械磁盘完全能够胜任 Kafka 线上环境。

  

### 硬盘容量规划

- 规划磁盘容量时你需要考虑下面这几个元素
  - 新增消息数
  - 消息留存时间
  - 平均消息大小
  - 备份数
  - 是否启用压缩
- 其实，硬盘不是瓶颈，给足就好。带宽才是。



### 带宽计算公式

- 带宽资源不足导致 Kafka 出现性能问题的比例至少占 60% 以上

- 即单台服务器使用带宽 700Mb / 3 ≈ 240Mbps。 这里的其实是相当保守的，你可以结合你自己机器的使用情况酌情减少此值。

- 举例：<br>

  1小时处理1TB为目标。 根据这个目标，我们每秒需要处理 2336Mb 的数据，除以 240，约等于 10 台服务器。 如果消息还需要额外复制两份，那么总的服务器台数还要乘以 3，即 30 台
