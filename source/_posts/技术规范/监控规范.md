---
title: 监控规范
toc: true
categories:
  - 技术规范

tags:
  - 技术规范
  - 运维
  - 监控
hide: true
date: 2021-07-30 17:27:14
---



服务难免有bug，我们可以忍。但服务一片黑，就是在自欺欺人。去吧把程序照明，别在掩耳盗铃。

<!-- more -->

------



## 常见监控点



### 系统层



|            | 监控点 | 常用监控方案及工具 | 常见指标 | 报警点 |
| ---------- | ------ | ------------------ | -------- | ------ |
| 虚拟机监控 |        |                    |          |        |
| 容器监控   |        |                    |          |        |
|            |        |                    |          |        |



### 网络层

|                | 监控点 | 常用监控方案及工具 | 常见指标 | 报警点 |
| -------------- | ------ | ------------------ | -------- | ------ |
| 监控专线带宽   |        |                    |          |        |
| 交换机基本情况 |        |                    |          |        |
| 网络延迟       |        |                    |          |        |





### 中间件

|          | 监控点 | 常用监控方案及工具 | 常见指标 | 报警点 |
| -------- | ------ | ------------------ | -------- | ------ |
| 注册中心 |        |                    |          |        |
|          |        |                    |          |        |
| mysql    |        |                    |          |        |
|          |        |                    |          |        |
| redis    |        |                    |          |        |
|          |        |                    |          |        |
| es       |        |                    |          |        |
|          |        |                    |          |        |



### 应用程序本身

|            | 监控点 | 常用监控方案及工具 | 常见指标 | 报警点 |
| ---------- | ------ | ------------------ | -------- | ------ |
| jvm        |        |                    |          |        |
|            |        |                    |          |        |
| GC         |        |                    |          |        |
|            |        |                    |          |        |
| 内存       |        |                    |          |        |
|            |        |                    |          |        |
| 线程       |        |                    |          |        |
|            |        |                    |          |        |
| 队列       |        |                    |          |        |
|            |        |                    |          |        |
| 缓存       |        |                    |          |        |
|            |        |                    |          |        |
| 可用性     |        |                    |          |        |
|            |        |                    |          |        |
| 业务正确性 |        |                    |          |        |





## 日志规范

### 日志规范

1. 对外服务接口，所有if分支需要打印日志
2. 使用logback异步打印日志。
3. 禁止打印全部实体，打印实体id即可，实体关键属性即可，尤其禁止打印 `toJsonString(obj)`<br>序列化会调用obj的get、set方法，有可能产生意外。
4. 打印traceId，traceId需要同调用链工具绑定。做到 traceId & log互相关联对方。<br>定时任务，线程池也需要打印traceId，具体方法见代码小抄，线程池上下文复用部分。



### 日志分级

- DEBUG 用于开发调试；敏感信息一律使用debug + infoMask。
- INFO 用于重要流程信息；if 分支打info日志，是一个程序员负责任的表现。
- WARN 用于需要关注但无需报警的问题；一般是为了方便排查的日志，<br>常用与不需要报警的业务中断，比如 “订单不存在，商品过期，优惠失效 等”
- ERROR 需要报警的异常；一般是系统异常、需要人工介入的业务异常，<br>比如“转账失败，请联系系统管理员”



### 日志分割

近期（7天内）日志，根据日期&大小分割，保存日志原文。<br>如果有日志平台，则不需要保存长期日志<br>没有日志平台的话，需要保存30天日志，根据日期分割，使用压缩格式，文件中要体现时间。



### 日志pattern

```
[%level] [%X{traceId}] [%d{yyyy-MM-dd HH:mm:ss.SSS}] [%thread]  [%logger{36}:%line] - [%msg]%n
```

